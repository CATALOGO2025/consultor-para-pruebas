<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Generador de Descripciones HTML con IA</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body {
      font-family: Calibri, sans-serif;
    }
    h1 {
      background-color: #00b5e2;
      color: white;
      padding: 20px;
      border-radius: 8px;
    }
    hr {
      margin: 40px 0;
      border: none;
      height: 2px;
      background-color: #ccc;
    }
    .formulario {
      background: #f9f9f9;
      padding: 20px;
      border-radius: 8px;
      margin-top: 20px;
    }
    .formulario label {
      display: block;
      margin-top: 10px;
    }
    .formulario input, .formulario button {
      margin-top: 5px;
      padding: 6px;
      width: 100%;
      box-sizing: border-box;
    }
    #preview {
      margin-top: 20px;
      padding: 20px;
      border: 2px solid #00b5e2;
      background: #f0faff;
      border-radius: 10px;
      font-size: 15px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    #progresoContainer {
      display: none;
      margin: 20px 0;
    }
    #barraProgreso {
      width: 0%;
      height: 20px;
      background-color: #00b5e2;
      color: white;
      text-align: center;
      line-height: 20px;
    }
  </style>
</head>
<body>
  <h1>üõçÔ∏è Generador de Descripciones para eCommerce</h1>

  <h2>üìù Instrucciones de uso</h2>
  <ol>
    <li>Descarga el <a href="Ejemplo_Productos_eCommerce_SKU.xlsx" download>archivo de ejemplo</a> y completa los datos de tus productos.</li>
    <li>Aseg√∫rate de completar la columna <strong>SKU</strong>, ya que este ser√° el identificador de cada producto en el HTML.</li>
    <li>Guarda el archivo en formato <strong>.xlsx</strong>.</li>
    <li>En esta p√°gina, selecciona el archivo con el bot√≥n <strong>"Cargar archivo Excel"</strong>.</li>
    <li>Ingresa tu clave de OpenAI para generar descripciones con IA.</li>
    <li>Haz clic en <strong>"Generar descripciones"</strong>.</li>
    <li>Una vez procesado, podr√°s descargar el archivo con columnas: <code>SKU</code> y <code>Descripci√≥n Larga</code>.</li>
  </ol>
  <p>‚ö†Ô∏è Todos los campos son opcionales, pero a mayor cantidad de informaci√≥n, mejor ser√° la descripci√≥n generada.</p>

  <hr>

  <h2>üìÑ Cargar archivo Excel</h2>
  <input type="file" id="fileInput" accept=".xlsx,.xls,.csv">
  <br><br>
  <label>üîë Clave API de OpenAI: <input type="password" id="apiKey" placeholder="Tu clave segura"></label>
  <br><br>
  <button onclick="procesarArchivo()">Generar descripciones</button>
  <div id="progresoContainer">
    <div id="barraProgreso">0%</div>
  </div>
  <br>
  <a id="downloadLink" style="display:none">üì• Descargar archivo con descripciones</a>

  <hr>

  <h2>üßæ Ingreso individual de datos</h2>
  <div class="formulario">
    <label>Nombre del producto: <input type="text" id="nombre"></label>
    <label>Marca: <input type="text" id="marca"></label>
    <label>Material: <input type="text" id="material"></label>
    <label>Dise√±o: <input type="text" id="diseno"></label>
    <label>Dimensiones: <input type="text" id="dimensiones"></label>
    <label>Palabras clave (separadas por coma): <input type="text" id="palabrasClave"></label>
    <label>üîë Clave API de OpenAI: <input type="password" id="apiKeySingle" placeholder="Tu clave segura"></label>
    <button onclick="generarIndividual()">Generar descripci√≥n</button>
    <button onclick="descargarHTML()">üíæ Descargar como HTML</button>
</div>
<div id="preview"></div>
  </div>

  <script>
    let ultimaDescripcionGenerada = "";

    async function generarDescripcion(producto, apiKey) {
      const prompt = `Genera una descripci√≥n HTML atractiva con etiquetas <h3> y <p> para un producto de eCommerce. Informaci√≥n disponible:
- Nombre: ${producto.nombre || ""}
- Marca: ${producto.marca || ""}
- Material: ${producto.material || ""}
- Dise√±o: ${producto.dise√±o || ""}
- Dimensiones: ${producto.dimensiones || ""}
- Palabras clave: ${producto.palabrasClave || ""}

Usa un tono semiformal, amigable y claro para cualquier persona. La descripci√≥n debe tener entre 3 a 5 p√°rrafos breves, debe motivar al usuario a agregar el producto al carro. Incluye llamados a la acci√≥n. Usa etiquetas <strong> y <em> donde corresponda e inicia con un t√≠tulo en <h3>.`;

      const response = await fetch("https://api.openai.com/v1/chat/completions", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${apiKey}`
        },
        body: JSON.stringify({
          model: "gpt-4",
          messages: [{ role: "user", content: prompt }],
          temperature: 0.7
        })
      });

      const data = await response.json();
      return data.choices?.[0]?.message?.content || "";
    }

    async function generarIndividual() {
      const producto = {
        nombre: document.getElementById("nombre").value,
        marca: document.getElementById("marca").value,
        material: document.getElementById("material").value,
        dise√±o: document.getElementById("diseno").value,
        dimensiones: document.getElementById("dimensiones").value,
        palabrasClave: document.getElementById("palabrasClave").value
      };
      const apiKey = document.getElementById("apiKeySingle").value;
      if (!apiKey) {
        alert("Por favor ingresa tu clave de API.");
        return;
      }
      const descripcion = await generarDescripcion(producto, apiKey);
      ultimaDescripcionGenerada = descripcion;
      document.getElementById("preview").innerHTML = `<h3>üîç Vista previa:</h3>` + descripcion;
    }

    function descargarHTML() {
      if (!ultimaDescripcionGenerada) {
        alert("Primero debes generar una descripci√≥n.");
        return;
      }
      const blob = new Blob([ultimaDescripcionGenerada], { type: "text/html" });
      const url = URL.createObjectURL(blob);
      const link = document.createElement("a");
      link.href = url;
      link.download = "descripcion_individual.html";
      link.click();
    }

    async function procesarArchivo() {
      const file = document.getElementById("fileInput").files[0];
      const apiKey = document.getElementById("apiKey").value;
      if (!file || !apiKey) {
        alert("Por favor carga un archivo y tu clave de API.");
        return;
      }

      const reader = new FileReader();
      reader.onload = async function(e) {
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, { type: 'array' });
        const sheetName = workbook.SheetNames[0];
        const sheet = XLSX.utils.sheet_to_json(workbook.Sheets[sheetName]);

        const resultados = [];
        const progreso = document.getElementById("barraProgreso");
        const contenedor = document.getElementById("progresoContainer");
        contenedor.style.display = "block";

        for (let i = 0; i < sheet.length; i++) {
          const producto = {
            nombre: sheet[i].nombre || "",
            marca: sheet[i].marca || "",
            material: sheet[i].material || "",
            dise√±o: sheet[i].dise√±o || "",
            dimensiones: sheet[i].dimensiones || "",
            palabrasClave: sheet[i].palabrasClave || ""
          };
          const prompt = `Genera una descripci√≥n HTML atractiva con etiquetas <h3> y <p> para un producto de eCommerce. Informaci√≥n disponible:
- Nombre: ${producto.nombre}
- Marca: ${producto.marca}
- Material: ${producto.material}
- Dise√±o: ${producto.dise√±o}
- Dimensiones: ${producto.dimensiones}
- Palabras clave: ${producto.palabrasClave}

Usa un tono semiformal, amigable y claro para cualquier persona. La descripci√≥n debe tener entre 3 a 5 p√°rrafos breves, debe motivar al usuario a agregar el producto al carro. Incluye llamados a la acci√≥n. Usa etiquetas <strong> y <em> donde corresponda e inicia con un t√≠tulo en <h3>.`;

          const response = await fetch("https://api.openai.com/v1/chat/completions", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              "Authorization": `Bearer ${apiKey}`
            },
            body: JSON.stringify({
              model: "gpt-4",
              messages: [{ role: "user", content: prompt }],
              temperature: 0.7
            })
          });
          const data = await response.json();
          const descripcion = data.choices?.[0]?.message?.content || "";
          resultados.push({
            SKU: sheet[i].sku || `item_${i + 1}`,
            "Descripci√≥n Larga": descripcion
          });
          const porcentaje = Math.round(((i + 1) / sheet.length) * 100);
          progreso.style.width = porcentaje + "%";
          progreso.textContent = porcentaje + "%";
        }

        const nuevaHoja = XLSX.utils.json_to_sheet(resultados);
        const nuevoLibro = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(nuevoLibro, nuevaHoja, "Resultados");
        const wbout = XLSX.write(nuevoLibro, { bookType: 'xlsx', type: 'array' });
        const blob = new Blob([wbout], { type: 'application/octet-stream' });
        const url = URL.createObjectURL(blob);
        const link = document.getElementById("downloadLink");
        link.href = url;
        link.download = "descripciones_generadas.xlsx";
        link.style.display = "inline";
        link.textContent = "üì• Descargar archivo con descripciones";
        contenedor.style.display = "none";
      };
      reader.readAsArrayBuffer(file);
    }
  </script>
</body>
</html>
